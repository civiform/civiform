# example: ../roc/bin/ssh-connection -g sgdev -d civiform-artistic-halibut -k bastion
while getopts g:d:k:p flag
do
    case "${flag}" in
        g) resource_group=${OPTARG};;
        d) database_name=${OPTARG};;
        k) key_name=${OPTARG};;
    esac
done

echo "Getting the bastion vm's ip address"
vm_ip_address=$(az network public-ip show -g ${resource_group} -n ${resource_group}-ip --query "ipAddress" | tr -d '"')

echo "Getting the postgres host name"
postgres_host=$(az postgres server show -g ${resource_group} -n ${database_name} --query "fullyQualifiedDomainName" | tr -d '"')

echo "ssh command: ssh -i $HOME/.ssh/${key_name} adminuser@${vm_ip_address}"
echo "pghost: ${postgres_host}"

# note: to get data out via a pg dump, need to 
# update the postgres version (instructions at the stack overflow below)
# https://stackoverflow.com/questions/52765873/how-to-upgrade-to-postgresql-11-for-ubuntu-18-04

# Source - https://stackoverflow.com/a/61565445
# Posted by Michael Parker, modified by community. See post 'Timeline' for change history
# Retrieved 2026-02-04, License - CC BY-SA 4.0

name: Translations Context Reminder

on:
  pull_request:
    types:
      - closed

jobs:
  notify_on_messages_change:
    if: github.event.pull_request.merged == true
    runs-on: ubuntu-latest
    steps:
      - name: Check if messages file was modified
        id: check_messages
        uses: actions/github-script@v7
        with:
          script: |
            const files = await github.rest.pulls.listFiles({
              owner: context.repo.owner,
              repo: context.repo.repo,
              pull_number: context.payload.pull_request.number
            });
            const messagesModified = files.data.some(file => file.filename === 'server/conf/i18n/messages');
            core.setOutput('modified', messagesModified);

      - name: Send Slack notification
        if: steps.check_messages.outputs.modified == 'true'
        uses: slackapi/slack-github-action@v2.0.0
        with:
          webhook: ${{ secrets.SLACK_WEBHOOK_URL }}
          webhook-type: incoming-webhook
          payload: |
            {
              "text": "Translations update needed",
              "blocks": [
                {
                  "type": "section",
                  "text": {
                    "type": "mrkdwn",
                    "text": "*PR merged with messages file changes*\n<${{ github.event.pull_request.html_url }}|${{ github.event.pull_request.title }}>\n\nThe base messages file was modified. Translation context may need updating."
                  }
                }
              ]
            }


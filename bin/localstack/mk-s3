#! /usr/bin/env bash

# DOC: Create S3 bucket in localstack.

source bin/lib.sh
source bin/localstack/lib.sh

APPLICANT_BUCKET_NAME="civiform-local-s3"
PUBLIC_BUCKET_NAME="civiform-local-s3-public"

function check_bucket() {
  echo "s3api get-bucket-location --bucket ${1}"
}

function create_bucket() {
  echo "s3api create-bucket
  --bucket ${1}
  --region us-west-2
  --create-bucket-configuration LocationConstraint=us-west-2"
}

function check_or_create_bucket() {
  check_with_bucket=$(check_bucket ${1})
  create_with_bucket=$(create_bucket ${1})
  localstack::run_command "${check_with_bucket}" \
    || localstack::run_command "${create_with_bucket}"
}

check_or_create_bucket ${APPLICANT_BUCKET_NAME}
check_or_create_bucket ${PUBLIC_BUCKET_NAME}

#! /usr/bin/env bash

# DOC: Dumps question and program configuration from the local dev environment into postgres archive file, dev_programs.dump.

source bin/lib.sh

docker::set_network_name_dev

readonly CMD="/usr/bin/pg_dump \
    -w \
    -Fc \
    -h db \
    -U postgres \
    -t programs \
    -t questions \
    -t versions \
    -t versions_programs \
    -t versions_questions \
    postgres -f /project/dev_programs.dump"

readonly COMPOSE_CMD="docker compose \
  -f docker-compose.yml \
  -f docker-compose.dev.yml"

${COMPOSE_CMD} \
  up db \
  --no-deps \
  --wait \
  -d

${COMPOSE_CMD} exec -it -e "PGPASSWORD=example" db ${CMD}
${COMPOSE_CMD} cp db:/project/dev_programs.dump dev_programs.dump

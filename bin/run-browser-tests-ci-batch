#! /usr/bin/env python3

# DOC: Run a batch of browser tests in CI mode. Takes one argument, the
# DOC: 1-indexed batch number.

import glob
import math
import subprocess
import sys

BATCH_COUNT = 4

batch_number = sys.argv[1]

if batch_number < 1 or batch_number > BATCH_COUNT:
    print(f"Invalid batch number: {batch_number}")

test_files = glob.glob('browser-test/src/*.test.ts')
test_files.sort()
test_files_count = len(glob.glob('browser-test/src/*.test.ts'))
batch_size = math.ceil(test_files_count / BATCH_COUNT)

batch_contents = test_files[(batch_number - 1) * batch_size : batch_number * batch_size]
shell_command = ["./bin/run-browser-tests-ci-batch"] + batch_contents

subprocess.run(shell_command)

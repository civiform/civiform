#! /usr/bin/env bash

# DOC: Build a new docker image for running the browser tests and optionally push to Docker Hub if PUSH_IMAGE is set to anything.

source bin/lib.sh

docker build \
  -t civiform-browser-test:latest \
  -f browser-test/playwright.Dockerfile \
  --cache-from civiform/civiform-browser-test:latest \
  --build-arg BUILDKIT_INLINE_CACHE=1 \
  browser-test/

if [[ "${PUSH_IMAGE}" ]]; then
  docker::do_dockerhub_login

  docker tag \
    civiform-browser-test:latest \
    civiform/civiform-browser-test:latest

  # Push the new image to the Docker Hub registry
  docker push docker.io/civiform/civiform-browser-test:latest
fi

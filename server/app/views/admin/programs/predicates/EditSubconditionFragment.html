<!--/*@thymesvar id="model" type="views.admin.programs.predicates.EditSubconditionPartialViewModel"*/-->
<th:block th:fragment="editSubcondition(conditionId, subconditionId, model)">
  <div class="subcondition-container">
    <!-- Define input ids in the expected format: 
    questionDropdownId: conditionId-<conditionId>-subconditionId-<subconditionId>-question
    scalarDropdownId:   conditionId-<conditionId>-subconditionId-<subconditionId>-scalar
    operatorDropdownId: conditionId-<conditionId>-subconditionId-<subconditionId>-operator 
    valueInputId:       conditionId-<conditionId>-subconditionId-<subconditionId>-value
    -->
    <div
      class="border-left-05 border-base-lighter padding-left-3"
      th:with="questionDropdownId=${'condition-' + conditionId + '-subcondition-' + subconditionId + '-question'}, scalarDropDownId=${'condition-' + conditionId + '-subcondition-' + subconditionId + '-scalar'},operatorDropdownId=${'condition-' + conditionId + '-subcondition-' + subconditionId + '-operator'}"
    >
      <div class="usa-form-group margin-top-2">
        <label class="usa-label" th:for="${questionDropdownId}"
          >[[#{label.predicateQuestion}]]<span class="usa-hint--required"
            >*</span
          ></label
        >
        <select
          class="usa-select cf-predicate-question-select"
          th:id="${questionDropdownId}"
          th:name="${questionDropdownId}"
          th:data-scalar-target-id="${scalarDropDownId}"
          th:hx-post="${model.hxEditSubconditionEndpoint()}"
          th:hx-vals='|{"conditionId": "${conditionId}", "subconditionId": "${subconditionId}"}|'
          hx-target="closest div.subcondition-container"
          hx-swap="outerHTML"
        >
          <option
            th:selected="${!model.hasSelectedQuestion}"
            th:hidden="${model.hasSelectedQuestion}"
            th:text="#{option.selectPlaceholder}"
          ></option>
          <option
            th:each="question : ${model.questionOptions}"
            th:value="${question.value()}"
            th:text="${question.displayText()}"
            th:selected="${question.selected()}"
          ></option>
        </select>
      </div>
      <div class="display-flex flex-gap flex-wrap margin-top-2">
        <div
          class="usa-form-group cf-predicate-scalar-select tablet:grid-col margin-top-0"
        >
          <label class="usa-label" th:for="${scalarDropDownId}"
            >[[#{label.predicateField}]]<span class="usa-hint--required"
              >*</span
            ></label
          >
          <select
            class="usa-select"
            th:id="${scalarDropDownId}"
            th:name="${scalarDropDownId}"
            th:data-operator-target-id="${operatorDropdownId}"
            th:disabled="${!model.hasSelectedQuestion}"
          >
            <option
              th:selected="${!model.hasSelectedQuestion}"
              th:hidden="${model.hasSelectedQuestion}"
              th:text="#{option.selectPlaceholder}"
            ></option>
            <option
              th:each="scalar : ${model.scalarOptions}"
              th:value="${scalar.value()}"
              th:text="${scalar.displayText()}"
              th:data-type="${scalar.scalarType()}"
              th:selected="${scalar.selected()}"
            ></option>
          </select>
        </div>
        <div
          class="usa-form-group cf-predicate-operator-select tablet:grid-col margin-top-0"
        >
          <label class="usa-label" th:for="${operatorDropdownId}"
            >[[#{label.predicateState}]]<span class="usa-hint--required"
              >*</span
            ></label
          >
          <select
            class="usa-select"
            th:id="${operatorDropdownId}"
            th:name="${operatorDropdownId}"
            th:disabled="${!model.hasSelectedQuestion}"
            th:data-condition-id="${conditionId}"
            th:data-subcondition-id="${subconditionId}"
          >
            <option
              th:selected="${!model.hasSelectedQuestion}"
              th:hidden="${model.hasSelectedQuestion}"
              th:text="#{option.selectPlaceholder}"
            ></option>
            <option
              th:each="operator : ${model.operatorOptions}"
              th:value="${operator.value()}"
              th:text="${operator.displayText()}"
              th:selected="${operator.selected()}"
            ></option>
          </select>
        </div>
      </div>
      <div
        th:replace="~{admin/programs/predicates/PredicateValuesInputFragment :: predicateValues(${model.selectedQuestionType}, ${model.valueOptions}, ${conditionId}, ${subconditionId}, ${model.hasSelectedQuestion})}"
      ></div>
      <div class="width-full display-inline-block">
        <a
          href="#"
          class="usa-link usa-button usa-button--unstyled float-right text-secondary-dark"
          th:text="#{link.predicateDeleteSubcondition}"
        ></a>
      </div>
    </div>
  </div>
  <!-- Append button to add subcondition iff this is a new subcondition. Skip when updating the selected question
   of an existing subcondition. -->
  <div
    class="margin-top-3"
    th:hx-target="this"
    th:if="${model.renderAddSubcondition}"
  >
    <button
      type="button"
      class="usa-button usa-button--unstyled zero-top-margin"
      th:hx-post="${model.hxEditSubconditionEndpoint()}"
      th:with="nextSubconditionId=${subconditionId + 1}"
      th:hx-vals='|{"conditionId": "${conditionId}", "subconditionId": "${nextSubconditionId}" }|'
      hx-swap="outerHTML"
    >
      <cf:icon type="icon-add" />[[#{link.predicateAddSubcondition}]]
    </button>
  </div>
</th:block>

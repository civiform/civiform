<!--/*@thymesVar id="question" type="services.applicant.question.ApplicantQuestion"*/-->
<!--/*@thymesVar id="questionRendererParams" type="views.questiontypes.ApplicantQuestionRendererParams"*/-->

<div
  th:fragment="map(question, questionRendererParams)"
  th:with="mapQuestion=${question.createMapQuestion()},
             questionId=${'id-' + #strings.randomAlphanumeric(8)},
              mapId=${'cf-map-' + #strings.randomAlphanumeric(8)},
              firstPathWithError=${mapQuestion.getFirstPathWithError()},
             hasGroupErrors=${mapQuestion.getValidationErrors().get(question.getContextualizedPath())},"
  th:id="${questionId}"
  class="cf-question-map"
  th:classappend="${hasGroupErrors ? 'cf-question-field-with-error' : ''}"
  data-testid="questionRoot"
>
  <form class="usa-form">
    <div th:each="filter, i : ${mapQuestion.getFilters()}">
      <label
        class="usa-label"
        th:for="'filter' + ${i.index + 1}"
        th:utext="${filter.formattedSettingDisplayName(ariaLabelForNewTabs)}"
      ></label>
      <select
        class="usa-select"
        th:name="'filter' + ${i.index + 1}"
        th:id="'filter' + ${i.index + 1}"
      >
        <option value>- Select -</option>
        <option
          th:if="${questionRendererParams.geoJson().isPresent()}"
          th:each="option : ${questionRendererParams.geoJson().get().getPossibleValuesForKey(filter.settingKey())}"
          th:value="${option}"
          th:text="${option}"
        ></option>
      </select>
    </div>
  </form>
  <!-- TODO(#11003): Build out applicant view of map question -->
  <!-- TODO(#11150): Add map question preview functionality -->
  <div th:id="${mapId}" class="square-mobile"></div>
  <script
    th:if="${questionRendererParams.geoJson().isPresent()}"
    th:inline="javascript"
    th:nonce="${cspNonce}"
  >
    window.app = window.app || {}
    window.app.data = window.app.data || {}
    window.app.data.maps = window.app.data.maps || {}

    id = /*[[${mapId}]]*/ 'id'
    console.log(/*[[${mapQuestion.getNameValue()}]]*/ '', /*[[${mapQuestion.getAddressValue()}]]*/ '', /*[[${mapQuestion.getDetailsUrlValue()}]]*/ '')
    window.app.data.maps[id] = {
      geoJson: /*[[${questionRendererParams.geoJson().get()}]]*/ {},
      settings: {
        nameGeoJsonKey: /*[[${mapQuestion.getNameValue()}]]*/ '',
        addressGeoJsonKey: /*[[${mapQuestion.getAddressValue()}]]*/ '',
        detailsUrlGeoJsonKey: /*[[${mapQuestion.getDetailsUrlValue()}]]*/ '',
      },
    }
  </script>
</div>

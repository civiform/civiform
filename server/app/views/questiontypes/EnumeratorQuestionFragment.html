<div
  th:fragment="enumerator(question)"
  th:with="enumeratorQuestion=${question.createEnumeratorQuestion()},
             questionId=${#strings.randomAlphanumeric(8)}"
  th:id="${questionId}"
  class="cf-question-enumerator"
>
  <!-- Title and Help Text -->
  <div
    th:replace="~{questiontypes/QuestionBaseFragment :: titleAndHelpTextSingleInput(${question}, ${questionId}, ${inputId})}"
  ></div>

  <!-- Display errors -->
  <div
    th:replace="~{questiontypes/QuestionBaseFragment :: validationErrors(${enumeratorQuestion.getValidationErrors().get(question.getContextualizedPath())})}"
  ></div>

  <div
    th:data-label-text="#{placeholder.entityName(${enumeratorQuestion.getEntityType()})}"
    th:data-button-text="#{button.removeEntity(${enumeratorQuestion.getEntityType()})}"
  >
    <div id="enumerator-fields">
      <div th:each="option,iterator: ${enumeratorQuestion.getEntityNames()}">
        <div
          th:replace="~{this :: enumeratorField(#{strings.randomAlphanumeric(8)}, ${question.getContextualizedPath()}, ${entityNames.get(index)}, ${index})}"
        ></div>
      </div>
    </div>
    <div th:replace="~{this :: enumeratorFieldTemplate}"></div>

    <!-- Add entity button -->
    <button
      th:text="#{button.addEntity(${enumeratorQuestion.getEntityType()})}"
      id="enumerator-field-add-button"
      type="button"
    ></button>
  </div>
</div>

<div
  th:fragment="enumeratorField(inputId, path, existingEntity, existingIndex)"
  class="cf-entity-name-input"
>
  <label
    th:for="${inputId}"
    th:with="indexString=${existingIndex.isEmpty() ? '' : '#' + (existingIndex + 1)}"
  >
    <span
      th:text="#{placeholder.entityName(${enumeratorQuestion.getEntityType()})} + ${indexString}"
    ></span>
  </label>
  <input
    type="text"
    class="usa-input"
    maxlength="10000"
    th:id="${inputId}"
    th:value="${existingEntity}"
    th:name="${path}"
  />
  <!-- TODO: Load the errors for the field properly. For now this is a placeholder div so TS won't error -->
  <div th:id="${inputId + '-errors'}"></div>
</div>

<div
  th:fragment="enumeratorFieldTemplate"
  id="enumerator-field-template"
  class="hidden"
>
  <div
    th:replace="~{this :: enumeratorField(enumerator-field-template-input, ${question.getContextualizedPath()}, '', '')}"
  ></div>
  <button type="button">a thing</button>
</div>

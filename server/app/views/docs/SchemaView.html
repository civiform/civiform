<!--/*@thymesVar id="templateGlobals" type="views.admin.shared.TemplateGlobals"*/-->
<!--/*@thymesVar id="model" type="views.docs.SchemaViewModel"*/-->
<th:block th:fragment="content">
  <div class="my-4 text-blue-600 hover:text-blue-500">
    <ul class="flex gap-4">
      <li class="my-2 mr-2">
        <a href="/docs/api/programs">API documentation</a>
      </li>
      <li class="border-b-2 m-2 border-blue-400 border-b-2">
        <a href="/docs/api/schemas/">API Schema Viewer</a>
      </li>
    </ul>
  </div>

  <p class="max-w-prose my-4">
    This page shows a visualization of the OpenAPI Schema. Both version 2
    (formerly Swagger 2) and version 3 are available.
  </p>
  <p class="max-w-prose my-4">
    We recommend only using version 3 unless there is a specific need for the
    older format.
  </p>

  <form
    id="form"
    th:action="${model.formChangeUrl()}"
    class="usa-form width-auto maxw-none grid-row flex-row flex-align-baseline"
  >
    <label class="usa-label padding-right-1 margin-top-0" for="programSlug"
      >Program:
    </label>
    <select
      id="programSlug"
      name="programSlug"
      class="usa-select width-auto margin-right-2"
    >
      <option
        th:each="programSlug: ${model.allNonExternalProgramSlugs()}"
        th:value="${programSlug}"
        th:text="${programSlug}"
        th:selected="${model.programSlug() == programSlug}"
      ></option>
    </select>

    <label class="usa-label padding-right-1 margin-top-0" for="stage"
      >Status:
    </label>

    <select
      id="stage"
      name="stage"
      class="usa-select width-auto margin-right-2"
    >
      <option
        value="active"
        th:selected="${model.stage().orElse('') == 'active'}"
      >
        Active
      </option>
      <option
        value="draft"
        th:selected="${model.stage().orElse('') == 'draft'}"
      >
        Draft
      </option>
    </select>

    <label class="usa-label padding-right-1 margin-top-0" for="openApiVersion"
      >OpenApi Version:
    </label>

    <select
      id="openApiVersion"
      name="openApiVersion"
      class="usa-select width-auto margin-right-2"
    >
      <option
        th:each="openApiVersion: ${model.getOpenApiVersions()}"
        th:value="${openApiVersion.toString()}"
        th:text="${openApiVersion.getVersionNumber()}"
        th:selected="${model.openApiVersion().orElse('') == openApiVersion.toString()}"
      ></option>
    </select>
  </form>

  <style type="text/css" th:nonce="${templateGlobals.cspNonce()}">
    <!--/*
    TODO: Remove along with Tailwind. This is a one off customization to keep the screen similar to the API docs.
    */-->
    main.padding-y-10 {
      padding-top: 6.35rem;
    }

    <!--/* Hiding this bar from the code generated by the swagger ui library */-->
    .swagger-ui > .topbar {
      display: none;
    }
  </style>

  <div id="swagger-ui"></div>
</th:block>

<th:block th:fragment="scripts">
  <script
    type="text/javascript"
    th:nonce="${templateGlobals.cspNonce()}"
    th:inline="javascript"
  >
    document.addEventListener('DOMContentLoaded', () => {
      SwaggerUIBundle({
        url: /*[[${model.url()}]]*/,
        dom_id: '#swagger-ui',
        validatorUrl: null,
        presets: [
          SwaggerUIBundle.presets.apis,
          SwaggerUIStandalonePreset
        ],
        layout: 'StandaloneLayout',
        responseInterceptor: (response) => {
          if (response.status === 404) {
            console.log('404');
            const uiError = document.querySelector('.swagger-ui.swagger-container');
            const customErrorMessage = 'A program with this status could not be found.';
            uiError.innerHTML = `<div data-testid="ui-error" style="display: flex; justify-content: center; margin: 4rem; font-size: 1.6rem;">${customErrorMessage}</div>`;
          }
          return response;
        }
      });

      document.getElementById('programSlug')?.addEventListener('change', () => document.getElementById('form').submit());
      document.getElementById('stage')?.addEventListener('change', () => document.getElementById('form').submit());
      document.getElementById('openApiVersion')?.addEventListener('change', () => document.getElementById('form').submit());
    });
  </script>
</th:block>
